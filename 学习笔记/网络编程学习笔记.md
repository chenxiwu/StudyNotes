# 网络编程学习笔记

#
*作者：SY*
*2017-3-12 21:56:41*
##

+ 协议
	+ IP协议
		1. IP数据报包头通常包含20字节： 包含 `源IP地址` `目的IP地址`
		2. 后面跟着的部分为`数据`
	
	+ UDP协议
		1. UDP继承自IP数据报包头，同时含有UDP的包头，通常含有8个字节：
		包含：`源端口` `目的端口`
		2. 后面跟着的部分为`数据`
		
	+ TCP协议
		1. TCP继承自IP数据报包头，同时含有TCP的包头，通常含有20个字节：
		包含：`源端口` `目的端口` `窗口大小`等字段
		2. 后面跟着的部分为`数据`

+ 以太网五层体系结构
	+ OSI提供七层协议[物理层-数据链路层-网络层-传输层-会话层-表示层-应用层]，
	但是过于复杂，在现实中使用五层协议[物理层-数据链路层-网络层-传输层-应用层]
	
	+ 物理层
		1. 物理层考虑的是使用怎么样的媒介传输数据，是双绞线还是光纤等
		2. 从计算机出来的信号叫做基带信号，由于含有较多的低频成分，在
		很多信道上不能直接传输，需要进行调制：
			+ 调幅：调解载波的幅度
			+ 调频：调解载波的频率
			+ 调相：调解载波的相位
		3. 信噪比：信号的平均功率和噪声的平均功率之比，信噪比越大，信号
		质量越好
		4. 传输介质：
			+ 双绞线
			+ 同轴电缆
			+ 光缆
		5. 为了提高通信频率，提出了信道复用的概念：
			+ 频分复用：将不同的信号分为不同的频率传输
			+ 时分复用：将不同的信号分时传输

		6. 转发器：物理层使用的中间设备

	+ 数据链路层
		1. 数据链路层使用帧作为数据传输单元
		2. 三个基本问题：
			+ 封装成帧：
				1. 将IP数据报作为帧的数据域，长度[46~1500]。
				2. 首部添加MAC地址，MAC地址一共48位，6个字节。其中前3个字节由厂
				家向OUI组织购买，后三个字节由厂家只有指派
				3. MTU最大传送单元：规定了帧的数据部分长度上限
			+ 透明传输：
				1. 不管什么样的数据都可以放到这样的帧中传输
			+ 差错校验
				1. 一般使用CRC循环冗余校验
		3. 对于数据链路层，没有重传机制，不要求向上层提供可靠的服务。只对数据帧
		进行校验，如果无差错，则向上层投递。如果校验错误，则丢失当前帧。
		4. CSMA/CD 协议
			1. 即载波监听多点接入/碰撞检测
				+ 多点接入：说明是总线型网络
				+ 载波监听：发送前先监听总线上是否有其他站在发送数据，如果有
				则暂时不要发送数据，等待总线空闲时发送
				+ 碰撞检测：就是边发送边监听，适配器边发送数据，边检测信道上
				的信号电压变化情况，当几个站点同时在总线上发送数据时，总线上
				电压变化的幅度将会超出一定的阈值，表明此时产生了碰撞。
				一旦适配器检测到了碰撞，则立即停止发送数据，等待一个随机的
				时间再次发送。
		5. 网桥
			1. 网桥含有多个接口，每个接口可以连接不同的网段
			2. 网桥依靠转发表转发帧，转发表具有自学习功能
			3. 网桥可以将各个网段隔开，使不同网段的通信不会相互干扰！
			4. 数据链路层使用的中间设备
		6. 多接口的网桥--交换机
		
	+ 网络层
		1. 网络层向上提供简单灵活的、无连接的、尽最大努力的数据报服务。
		2. 传输单元为IP数据报
		3. 网际协议IP
			+ 地址解析协议ARP:
				1. IP -> [ARP] -> MAC地址
				2. 网络层使用的是IP地址，但是实际数据传输时，使用的是MAC地址
				3. ARP在主机的高速缓存中存放一个IP地址到MAC地址的映射表
				4. 过程：
					1. 主机A需要在局域网中向主机B发送信息
					2. 首先查找ARP高速缓存中是否含有主机B的IP地址，如果找到
					则将IP地址对应的MAC地址写入MAC帧中，然后发送数据报。
					如果没有找到IP地址，主机A广播发送一个ARP请求，
					请求包含本机IP和MAC地址，及目的IP地址。
					如果目的主机收到，则回复信息中含有本机IP地址及MAC地址。
					主机A将收到的ARP响应信息中包含的IP地址和MAC地址写入
					ARP高速缓存。
					其实主机B在收到主机A的ARP请求时，也会将主机A的IP地址及
					MAC地址写入自己的ARP速缓存中。
				5. ARP只能在本网上起作用，如果是跨网段通信，则只需要将数据报发送给路由器，使用ARP找到路由器的MAC地址，进行发送。
				

			+ 逆地址解析协议RARP:
				1. MAC -> [RARP] -> IP地址
				2. 由于DHCP协议已经包含了RARP协议，因此该协议很少使用
			+ 网际控制报文协议ICMP：
				1. ICMP的重要应用是分组网间探测PING
			+ 网际组管理协议IGMP：
			+ IP地址
				1. IPV4：由32位字符构成
				2. 为了记忆方便，采用点分十进制法
				3. IP地址中全0表示“this”，为保留地址
				4. IP地址为全1作为本地环回测试地址，例如：127.0.0.1
				网卡不会将数据报发送到任何网络
				5. IP地址由网络号+主机号构成
				6. 判断是否是同一个子网，通过 IP地址^子网掩码，如果结果相等
				则为同一子网段
				7. 在IP层抽象的互联网上只能看到IP数据报

			+ IP数据报
				1. 由首部及数据组成
				2. 首部包含源地址及目的地址
				3. 固定长度为20字节

		4. 路由器
			1. 路由器是网络层使用的中间设备
			2. 由于路由器通常需要连接多个网段，因此路由器具有多个IP地址
			3. 由于路由器跨网段工作，必须具备多个MAC地址
			4. 在数据链路层，只能看到MAC帧。IP数据报被封装在MAC帧中，
			MAC帧在不同的网络中传送时，源MAC地址，目的MAC地址将
			会随着路由器的变化而变化
			5. 分组转发
				1. 从IP数据报中找到目的主机的IP地址D，获取其中的网络地址N
				2. 如果N是与此路由器直接相连的某个网络地址，则直接交付（
				通过ARP找到目的主机的物理地址，转发帧）
				3. 如果路由表中有目的地址D的特定主机路由，则把数据报传送给
				路由表中指明的下一跳路由器

	+ 传输层
		+ 网络层与传输层的区别
			1. 网络层为两个主机之间提供逻辑通信。
			2. 传输层为两个主机中的应用进程之间提供端到端的裸机通信
			粒度更小。
		+ 对报文提供差错校验
		+ 端口
			1. 16位的数字
			2. 系统端口号：0~1023，应用程序不得占用
			3. 登记端口号：1024~49151
			4. 客户端使用端口号：49152~65535
		+ UDP（用户数据报协议）
			1. 提供广播、多播服务
			2. 无连接的
			3. 尽最大努力交付
			4. UDP传输的数据长度取决于应用层传递的个数
			5. UDP不管当前网络是否拥堵
		+ TCP（传输控制协议）
			1. 只能提供点对点的服务，也就是说不提供广播、多播服务
			2. 提供可靠的、面向连接的服务
			3. 根据对方给出的窗口值和当前网络的拥塞程序决定一个报文应该
			包含多少个字节
			4. TCP的端点叫做套接字(socket)，套接字 = IP + 端口
			表示：192.168.0.1:80
			5. 停止等待协议
				1. A -> B，如果B未收到数据、或者收到数据后，检测到有差错，
				B不会发送任何信息。A检测超时后，进行超时重传。
				2. 确认信息丢失
					1. A -> B，B -> A 的回复丢失了。
					2. A超时重发，B收到一个重复的数据报，
					3. 则B丢失该数据包，同时向A发出回复。
				3. 确认信息迟到
					1. A -> B，B -> A 的回复由于网络延迟等原因，迟到了
					2. A -> B重发数据包
					3. A收到重复的确认消息后，直接收下并丢弃
				4. 缺点
					1. 信道利用率低
				5. 改进
					1. 使用流水线传输
			6. TCP滑动窗口
				1. 发送端和接收端都有一个窗口
				2. 发送窗口的大小由接收窗口和当前网络的阻塞程度而定
				3. 发送窗口由2部分构成：
					1. 已发送但未收到确认
					2. 允许发送但尚未发送
				4. 接收端发出确认，发送端的窗口向右滑动，可发送字节增加
				5. 只有字段ACT=1,应答才有意义 
			7. TCP流量控制
				1. A -> B，如果B发送的ACK信息中，将接收窗口设为0，
				则A不能发送数据
				2. 如果B想要继续接收数据，于是给A发送的ACK信息中，将接收
				窗口设为非0。但是ACK信息丢失，则A在等待，B也在等待，形成
				死锁。
				3. 因此规定，只要接收的一方收到0窗口通知，就设置定时器，
				定时器超时时，发送零窗口探测报文段。接收方需要将当前窗口值
				作为回复信息，从而打破死锁。