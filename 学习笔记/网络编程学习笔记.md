# 网络编程学习笔记

#
*作者：SY*
*2017-3-12 21:56:41*
##

+ 协议
	+ IP协议
		1. IP数据报包头通常包含20字节： 包含 `源IP地址` `目的IP地址`
		2. 后面跟着的部分为`数据`
	
	+ UDP协议
		1. UDP继承自IP数据报包头，同时含有UDP的包头，通常含有8个字节：
		包含：`源端口` `目的端口`
		2. 后面跟着的部分为`数据`
		
	+ TCP协议
		1. TCP继承自IP数据报包头，同时含有TCP的包头，通常含有20个字节：
		包含：`源端口` `目的端口` `窗口大小`等字段
		2. 后面跟着的部分为`数据`

+ 以太网五层体系结构
	+ OSI提供七层协议[物理层-数据链路层-网络层-传输层-会话层-表示层-应用层]，
	但是过于复杂，在现实中使用五层协议[物理层-数据链路层-网络层-传输层-应用层]
	
	+ 物理层
		1. 物理层考虑的是使用怎么样的媒介传输数据，是双绞线还是光纤等
		2. 从计算机出来的信号叫做基带信号，由于含有较多的低频成分，在
		很多信道上不能直接传输，需要进行调制：
			+ 调幅：调解载波的幅度
			+ 调频：调解载波的频率
			+ 调相：调解载波的相位
		3. 信噪比：信号的平均功率和噪声的平均功率之比，信噪比越大，信号
		质量越好
		4. 传输介质：
			+ 双绞线
			+ 同轴电缆
			+ 光缆
		5. 为了提高通信频率，提出了信道复用的概念：
			+ 频分复用：将不同的信号分为不同的频率传输
			+ 时分复用：将不同的信号分时传输

		6. 转发器：物理层使用的中间设备

	+ 数据链路层
		1. 数据链路层使用帧作为数据传输单元
		2. 三个基本问题：
			+ 封装成帧：
				1. 将IP数据报作为帧的数据域，长度[46~1500]。
				2. 首部添加MAC地址，MAC地址一共48位，6个字节。其中前3个字节由厂
				家向OUI组织购买，后三个字节由厂家只有指派
				3. MTU最大传送单元：规定了帧的数据部分长度上限
			+ 透明传输：
				1. 不管什么样的数据都可以放到这样的帧中传输
			+ 差错校验
				1. 一般使用CRC循环冗余校验
		3. 对于数据链路层，没有重传机制，不要求向上层提供可靠的服务。只对数据帧
		进行校验，如果无差错，则向上层投递。如果校验错误，则丢失当前帧。
		4. CSMA/CD 协议
			1. 即载波监听多点接入/碰撞检测
				+ 多点接入：说明是总线型网络
				+ 载波监听：发送前先监听总线上是否有其他站在发送数据，如果有
				则暂时不要发送数据，等待总线空闲时发送
				+ 碰撞检测：就是边发送边监听，适配器边发送数据，边检测信道上
				的信号电压变化情况，当几个站点同时在总线上发送数据时，总线上
				电压变化的幅度将会超出一定的阈值，表明此时产生了碰撞。
				一旦适配器检测到了碰撞，则立即停止发送数据，等待一个随机的
				时间再次发送。
		5. 网桥
			1. 网桥含有多个接口，每个接口可以连接不同的网段
			2. 网桥依靠转发表转发帧，转发表具有自学习功能
			3. 网桥可以将各个网段隔开，使不同网段的通信不会相互干扰！
			4. 数据链路层使用的中间设备
		6. 多接口的网桥--交换机
		
	+ 网络层
		1. 网络层向上提供简单灵活的、无连接的、尽最大努力的数据报服务。
		2. 传输单元为IP数据报
		3. 网际协议IP
			+ 地址解析协议ARP:
				1. IP -> [ARP] -> MAC地址
				2. 网络层使用的是IP地址，但是实际数据传输时，使用的是MAC地址
				3. ARP在主机的高速缓存中存放一个IP地址到MAC地址的映射表
				4. 过程：
					1. 主机A需要在局域网中向主机B发送信息
					2. 首先查找ARP高速缓存中是否含有主机B的IP地址，如果找到
					则将IP地址对应的MAC地址写入MAC帧中，然后发送数据报。
					如果没有找到IP地址，主机A广播发送一个ARP请求，
					请求包含本机IP和MAC地址，及目的IP地址。
					如果目的主机收到，则回复信息中含有本机IP地址及MAC地址。
					主机A将收到的ARP响应信息中包含的IP地址和MAC地址写入
					ARP高速缓存。
					其实主机B在收到主机A的ARP请求时，也会将主机A的IP地址及
					MAC地址写入自己的ARP速缓存中。
				5. ARP只能在本网上起作用，如果是跨网段通信，则只需要将数据报发送给路由器，使用ARP找到路由器的MAC地址，进行发送。
				

			+ 逆地址解析协议RARP:
				1. MAC -> [RARP] -> IP地址
				2. 由于DHCP协议已经包含了RARP协议，因此该协议很少使用
			+ 网际控制报文协议ICMP：
				1. ICMP的重要应用是分组网间探测PING
			+ 网际组管理协议IGMP：
			+ IP地址
				1. IPV4：由32位字符构成
				2. 为了记忆方便，采用点分十进制法
				3. IP地址中全0表示“this”，为保留地址
				4. IP地址为全1作为本地环回测试地址，例如：127.0.0.1
				网卡不会将数据报发送到任何网络
				5. IP地址由网络号+主机号构成
				6. 判断是否是同一个子网，通过 IP地址^子网掩码，如果结果相等
				则为同一子网段
				7. 在IP层抽象的互联网上只能看到IP数据报

			+ IP数据报
				1. 由首部及数据组成
				2. 首部包含源地址及目的地址
				3. 固定长度为20字节

		4. 路由器
			1. 路由器是网络层使用的中间设备
			2. 由于路由器通常需要连接多个网段，因此路由器具有多个IP地址
			3. 由于路由器跨网段工作，必须具备多个MAC地址
			4. 在数据链路层，只能看到MAC帧。IP数据报被封装在MAC帧中，
			MAC帧在不同的网络中传送时，源MAC地址，目的MAC地址将
			会随着路由器的变化而变化
			5. 分组转发
				1. 从IP数据报中找到目的主机的IP地址D，获取其中的网络地址N
				2. 如果N是与此路由器直接相连的某个网络地址，则直接交付（
				通过ARP找到目的主机的物理地址，转发帧）
				3. 如果路由表中有目的地址D的特定主机路由，则把数据报传送给
				路由表中指明的下一跳路由器

	+ 传输层
		+ 网络层与传输层的区别
			1. 网络层为两个主机之间提供逻辑通信。
			2. 传输层为两个主机中的应用进程之间提供端到端的裸机通信
			粒度更小。
		+ 对报文提供差错校验
		+ 端口
			1. 16位的数字
			2. 系统端口号：0~1023，应用程序不得占用
			3. 登记端口号：1024~49151
			4. 客户端使用端口号：49152~65535
		+ UDP（用户数据报协议）
			1. 提供广播、多播服务
			2. 无连接的
			3. 尽最大努力交付
			4. UDP传输的数据长度取决于应用层传递的个数
			5. UDP不管当前网络是否拥堵
		+ TCP（传输控制协议）
			1. 只能提供点对点的服务，也就是说不提供广播、多播服务
			2. 提供可靠的、面向连接的服务
			3. 根据对方给出的窗口值和当前网络的拥塞程序决定一个报文应该
			包含多少个字节
			4. TCP的端点叫做套接字(socket)，套接字 = IP + 端口
			表示：192.168.0.1:80
			5. 停止等待协议
				1. A -> B，如果B未收到数据、或者收到数据后，检测到有差错，
				B不会发送任何信息。A检测超时后，进行超时重传。
				2. 确认信息丢失
					1. A -> B，B -> A 的回复丢失了。
					2. A超时重发，B收到一个重复的数据报，
					3. 则B丢失该数据包，同时向A发出回复。
				3. 确认信息迟到
					1. A -> B，B -> A 的回复由于网络延迟等原因，迟到了
					2. A -> B重发数据包
					3. A收到重复的确认消息后，直接收下并丢弃
				4. 缺点
					1. 信道利用率低
				5. 改进
					1. 使用流水线传输
			6. TCP滑动窗口
				1. 发送端和接收端都有一个窗口
				2. 发送窗口的大小由接收窗口和当前网络的阻塞程度而定
				3. 发送窗口由2部分构成：
					1. 已发送但未收到确认
					2. 允许发送但尚未发送
				4. 接收端发出确认，发送端的窗口向右滑动，可发送字节增加
				5. 只有字段ACT=1,应答才有意义 
			7. TCP流量控制
				1. A -> B，如果B发送的ACK信息中，将接收窗口设为0，
				则A不能发送数据
				2. 如果B想要继续接收数据，于是给A发送的ACK信息中，将接收
				窗口设为非0。但是ACK信息丢失，则A在等待，B也在等待，形成
				死锁。
				3. 因此规定，只要接收的一方收到0窗口通知，就设置定时器，
				定时器超时时，发送零窗口探测报文段。接收方需要将当前窗口值
				作为回复信息，从而打破死锁。
			8. 字段
				1. SYN：同步序号
					1. 当(SYN==1 && ACK==0),表明这是一个连接请求
					2. 当(SYN==1 && ACK==1),表明接收连接的报文
				2. FIN：终止令牌
					1. 当FIN=1时，用来释放一个连接
				3. SEQ：序号
					1. 占4字节，是每一个字节的顺序编号
				4. ACK：确认号
					1. 占4字节，表示期望收到对方下一个报文段的第一个数据
					字节的序号
			9. 三次握手
				1. A作为客户端，B作为服务器
				2. A->B: SYN=1, seq=x
				3. B->A: SYN=1,ACK=1, seq=y,ack=x+1
				4. A->B: ACK=1, seq=x+1,ack=y+1
				5. 为什么需要第三次握手？
					1. 如果只有2次握手，可能A发送的第一个连接请求，在中途
					被延迟。直至连接建立后才到达B，如果只有2次握手，则B
					会创建一个连接等待A发送数据，但是A并未建立这个连接，
					因此，不会发送数据。导致出现一个僵死连接
			10. 四次挥手
				1. A->B： FIN=1, seq=u
				2. B->A： ACK=1, seq=v,ack=u+1
				3. B->A： FIN=1, seq=w,ack=u+1
				4. A->B： ACK=1, seq=u+1,ack=w+1
				5. 为什么A在进入TIME_WAIT状态必须等待2MSL时间？
					1. 当B->A FIN包后，A->B的回复包可能丢失，因此B会超时
					重发，如果A马上进入CLOSE状态，将导致B->A的重发包无法
					相应，因此，必须等待。
			
			11. 保活计时器
				1. 服务器每收到客户端一次数据，都将重置保活计时器。
				2. 一般计时器为2小时
				3. 2小时没有收到客户端的数据，服务器发送一个探测报文段，
				以后每隔75分钟发送一次探测报文段，如果连续发送10次仍没有收到
				客户端回复，服务器将关闭连接。
	
	+ 应用层
		+ DNS域名系统
			1. DNS是分布式系统
			2. 将域名解析为IP地址
			3. 为了人类记忆方便，发明了域名系统
			4. 顶级域名
				1. 国家顶级域名：如cn表示中国，us表示美国
				2. 通用顶级域名：如com（公司企业），net（网络服务机构）
				org（非营利组织）
				3. 基础结构域名：只有一个，用于反向域名
		+ FTP文件传送协议
			1. 使用TCP协议
			2. 21端口用于处理连接	
			3. 20端口用于传送数据

		+ TFTP简单文件传送协议
			1. 使用UDP协议
			2. 每次传送的报文大小为512字节，最后一次不足512字节
			3. 数据报文编号从1开始
			4. 使用69端口作为连接请求
			5. 服务器选择其他端口处理数据
		+ TELNET远程终端协议
			1. 可以远程登录服务器
		+ WWW万维网
			1. URL统一资源定位符
				1. 格式：<协议>://<主机>:<端口>/<路径>
				2. HTTP默认端口：80，可省略
				3. 路径可省略
				4. 主机指的是域名
			2. HTTP超文本传送协议
				1. 使用TCP建立连接
				2. HTTP本身是无连接的，在交换报文之前不需要建立连接
				3. HTTP协议是无状态的
				4. 报文结构
					1. 请求报文：从客户到服务器发送的请求报文
					2. 相应报文：从服务器到客户的应答
			3. HTML超文本标记语言
				1. 为了解决页面制作标准化问题
				2. CGI通用网关接口
					1. 定义了动态文档的如果创建，输入程序应如何提供给应用程序
					以及输出结果应如何使用
					2. 动态文档一经创建，内容将固定下来，无法及时刷新屏幕
				3. 服务器推送
					1. 用于及时刷新屏幕
					2. 但是服务器需要维护TCP连接，造成开销很大
				4. 活动文档
					1. 浏览器请求活动文档时，服务器返回一段活动文档程序
					副本，该副本可以在浏览器端运行
					2. applet：小应用程序
						1. 用户从万维网服务器下载一个嵌入java小应用程序的HTML
						文档后，小应用程序执行。
		+ 电子邮件
			1. SMTP(简单邮件传输协议)
				1. 用于邮件发送协议
				2. 只能传送7位的ASCII码
			2. POP3(邮件读取协议)
			3. 使用TCP通信协议	
			4. 基于万维网的电子邮件
				1. A(使用新浪的邮箱) -> B(使用网易的邮箱)，使用浏览器发送
				邮件，首先A->新浪邮件服务器，使用HTTP协议。新浪服务器->
				网易服务器，使用SMTP协议。网易服务器->B，使用HTTP协议。
		+ DHCP(动态主机配置协议)
			1. 具体实现流程
				1. 发送广播包(目的IP地址：255.255.255.255)，同时将源IP
				地址设为0.0.0.0。
				2. 只有DHCP服务器才应答。
				3. 客户端收到服务器应答的IP地址
			2. 使用UDP协议
			3. DHCP客户使用端口68
			4. DHCP服务器使用端口67
			5. 一般DHCP服务器由路由器充当
		+ 系统调用
			1. TCP服务器
				1. 套接字创建，IP地址和端口为空。
				2. 可以调用bind()函数，绑定IP和端口
				3. 也可以由操作系统内核分配
				4. 使用listen()函数，设置套接字为被动方式
				5. 使用accept()函数，接收远端请求
				6. 主服务器创建一个新的套接字，同时创建一个新的进程处理
				连接。
				7. 通信结束，该进程关闭套接字，同时关闭进程
				8. 服务器总是有一个主服务进程和若干个从属服务进程，其中
				主进程用于处理连接，从属服务进程用于提供每个连接的服务
			2. TCP客户端
				1. 创建套接字
				2. 使用connect()函数和服务器建立连接
				3. 连接建立，通信开始
				4. 调用close()函数，断开连接
				
	+ 网络安全
		+ 对称加密
			1. 加密密匙和解密密匙是相同的
			2. 实现原理
				1. 将整个明文进行分组
				2. 每个分组为64位长的二进制数
				3. 分别对每一个分组进行加密，产生一组64位的密文数据
				4. 将各个分组产生的密文数据串接起来，得到整个秘闻
			3. 密匙是64位（实际长度56+8位奇偶校验）
			4. 算法公开
			5. 保密程度取决于密匙的保密
		+ 非对称加密
			1. 实现原理
				1. 发送方使用公钥，通过A算法对明文进行加密
				2. 接收方使用私钥，通过B算法对密文进行解密
				3. 通过公钥不能推导出私钥
				4. 公钥只能用于加密不能用于解密
		+ 数字签名
			1. 接受者可以核实发送者对报文的签名，别人不能伪造
			2. 实现原理：
				1. 假如 A->B 一段内容。
				2. A用自己的私钥对签名进行加密，用B的公钥对明文进行加密
				3. B收到数据后，用A的公钥对签名进行解密，并核实。
				用自己的私钥对密文进行解密。
		+ SSL安全套接层
			1. 介于应用层与传输层之间
			2. 发送方在发送TCP数据时，先经过加密再传输到传输层
			3. 接收方在接收TCP数据时，先经过解密再传输到应用层
